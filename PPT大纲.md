%%第一张：封面%%
> THN
# 网球视觉训练分析系统Tennis-Insight_system
- 参赛学校：武汉理工大学
- 项目团队
- **指导老师**
- **外部资源**
 ---
%%第二张：项目背景%%
> THN
### 项目背景
随着国家体育政策的不断推进，体育素质的培养已成为国家发展的重要因素和指标。网球作为一项日益受到关注的运动，在中国的普及和发展速度显著加快，尤其是郑钦文等新生代网球运动员的崛起，激发了全国范围内的“网球热”。然而，在这一背景下，中国的网球训练体系仍面临多重挑战。

![[Pasted image 20241003224047.png]]

----
%%第三张：痛点陈述%%
> THN
### 中国网球训练核心问题与痛点
1. **传统训练模式的局限性**：当前，中国学校的网球训练课程设计普遍陈旧，缺乏数字化和智能化的训练方案。大规模课堂教学无法兼顾每位学员的个体需求，导致训练反馈不足，教学质量难以保障。

2. **缺乏有效的复盘机制**：高水平网球运动队在训练和比赛后的复盘手段非常有限。现有的记录方法主要依赖计分，无法提供对每位运动员表现的定量和定性分析，阻碍了针对性训练计划的制定。

3. **高昂的技术投入**：市场上成熟的鹰眼系统虽然具备高水平的分析能力，但其部署成本极为昂贵，通常在50万到200万美元之间，令大部分大学训练队和网球俱乐部望而却步。例如，深圳湾的一小时鹰眼体验费用高达199美元，进一步限制了其普及。

---
%%第四张：解决方法概述%%
> THN
### 项目核心目标（解决方法）
为了解决上述问题，我们提出开发一套性价比更高，的网球视觉训练分析系统。该系统将运用的目标检测，关键点标定，姿态检测等先进CV算法，对视频中的球员，网球，球场边界等物体进行视觉标定增强，并实时反馈落点和球速以及技术动作类型等信息。不仅如此，系统还将将生成详尽的数据报告，包括整场比赛的网球落点复盘、球速区间图、运动员击球姿态评估，以及运动员整场比赛的得分追踪等。

通过这些数据，运动员可以自主识别自身薄弱项并制定针对性的训练计划。这一解决方案不仅提升了训练的科学性和有效性，还推动了网球训练的数字化转型，助力中国网球的发展，符合国家对体育产业数字化和智能化的要求。

通过这种方式，我们将有效降低技术和资金投入的门槛，促进更多网球爱好者和团队享受高水平的训练分析服务，为中国网球的未来发展打下坚实的基础

---
%%第五张：系统功能简介%% 
> THN

### 系统架构
- 系统功能主要由三层架构组成：
	1. 基础检测功能
		- 球员追踪与标定
		- 网球预测与标定
		- 球场keypoints标定
	2. 事件识别功能
		- 落地检测
		- 击球检测
	3. 数据分析功能
		- 球速
		- 落点
	4. 数据可视化功能
		- 迷你球场
		- 球速可视化
		- 落点可视化

----
%%第六张：技术解决方案和原理讲解%%
%%标定原理：网球追踪与标定%%

网球的轨迹数据是比赛分析中最基本和最有用的信息之一，后续的球速分析，姿态检测都是基于轨迹而来。但是，对于网球这项运动来说，球不仅小，而且由于球速过快的原因会导致图像模糊，难以捕捉网球。因此依靠常规的方法准确率会很低，于是我们在一个已经预训练好的并基于热图的深度学习网络(Tracknet)的基础上结合特殊算法以实现精确定位网球的坐标，并在图像上显示出其运动轨迹。

首先，先简要介绍下Tracknet的网络结构，其先采用 VGG-16 生成特征图；与其他深度学习网络不同，TrackNet 可以将多个连续帧作为输入，通过这种方式，TrackNet 不仅可以学习球的特征，还可以学习球的轨迹特征，以增强其物体识别和定位的能力。由于图像是通过池化层进行下采样和编码的，因此网络遵循 FCN 的上采样机制来生成用于对象检测的热图(heatmap)。最后，根据深度学习网络生成的热图(heatmap)计算出目标对象的位置。
![[tracknet.png]]

---
实现过程：
- 特征图获取：为了从一系列连续视频帧中检测并跟踪网球的位置，首先通过组合当前帧及前两帧作为输入，再通过预先训练好的Tracknet模型进行推理，获取特征图。
- 后处理：因为我们的目的是为了获得网球的坐标，所以要对模型的特征图再进行后处理，提取网球的精确坐标。将得到的特征图转换为二值化的热图，这一步是为了更好的突出网球的位置，然后利用用霍夫变换检测热图中的圆形区域。为了保证检测的准确率，排除噪声点的影响，让上一帧的网球预测坐标与这一帧进行距离检测，只有当距离小于规定的阈值，这一帧的坐标才算确定，当然，为例保证坐标的连续性，如果不存在上一帧的坐标，直接选择第一个检测到的圆作为网球位置。最后，将每一帧的网球坐标存在列表中，用于绘画轨迹。
- 轨迹绘画：在这里，将轨迹分为两种，第一种是有拖尾效果的轨迹，程序会在每一帧中不仅绘制当前帧中检测到的网球位置，还会在当前帧中绘制之前若干帧内检测到的所有网球位置。第二种是没有拖尾效果的轨迹，程序仅在当前帧中绘制最新检测到的网球位置。这种方式只会显示即时的位置信息，不会留下之前的轨迹记录。
 热图示例
 ![[热图示例.png]]


---
%%第七张%%
%%标定原理：球场keypoints标定%%
球场检测是非常关键的步骤，通过检测球场线和关键点。可以在有意义的坐标系中表示球员和球的位置，并且为后续的迷你球场，球速分析等奠定了基础。
传统的计算机视觉检测一般分为三部分：
1. 通过提取白色像素处理图像以进行进一步计算。网球场的线条总是白色的。因此，将从原始图像中提取球场单色图像中强度值高于特定阈值的像素。
2. 检测线条(使用霍夫变换)并将其分类为水平和垂直线。
3. 将结果线路与参考球场配置进行比较，选择最优的匹配线。
然而传统的cv算法复杂度很高，而且检测到的关键点也不准确，因此我们可以利用深度学习网络来生成关键点。不过传统算法引进了一个很重要的概念：参考球场配置(CourtReference)，不管是利用什么算法得到的关键点，最终都需要与参考球场进行匹配，并选择最优的配置。这里，先介绍什么是CourtReference这是一种负责建立和管理网球场的参考模型，其通过定义网球场各条关键线的位置，生成网球场的参考图像。
![[courtreference.png]]
有了参考球场，就可以将事先检测到的球场关键点与参考球场进行匹配，确定最佳匹配线。从而将参考球场与实际球场对应起来，以便后续的分析。

---
Homography matrix与球场匹配

实际用摄像头检测到的球场与参考球场的视角是不同的，因此需要将实际球场投影到参考球场上，这就需要用到单应矩阵(Homography matrix)，通过单应矩阵，可以将参考球场与实际球场联系起来。在这里，依次通过12个参考矩阵中的4个特定点与事先生成的对应的4个关键点（利用索引）生成单应矩阵，其中一定要保证4个关键点是有效的。

![[单应矩阵 3.png]]
在编程中，可以直接使用cv2.findHomography函数求得。

得到单应矩阵后，便可进行投影变换，利用H矩阵将参考关键点进行投影变换到实际球场上，并且计算投影的关键点与事先检测到的关键点的距离平均值（有些关键点无法检测到，因此使用平均，不是求和）。经过12个参考球场的比较，平均距离最短的就可以作为最终的参考球场，相对应的H就作为最后的单应矩阵，并且利用得到的单应矩阵进一步对关键点的位置进行了优化。


---

深度学习网络得到关键点和后处理优化

前面提到传统的cv算法比较复杂，且找到的关键点的效果一般，于是可以利用深度学习网络来生成关键点。我们发现，和网球追踪类似，关键点的追踪也可以依靠tracknet网络来实现，只需要改正输入通道数为3（只需要一张图片），输出通道数为15（14个关键点和一个中心点），经过模型推理，可以得到15张特征图，将前14张含有不同关键点的特征图转换为热图并进行霍夫圆变换检测便可得到关键点。这个方法相对于传统的cv算法提升了准确率，降低了复杂度。

在对关键点的生成中，我们还进行了优化，结合了传统的cv算法提高了关键点标定的准确率，具体思路是在已经生成的14个关键点周围裁剪一小部分区域，通过寻找直线的交点做进一步的优化
![[裁剪.png]]
![[关键点优化.png]]

获得关键点坐标后，利用cv2.circle函数绘制出关键点即可

---
%%第八张%%
%%标定原理：球员追踪标定%%
> XJH


----
%%第九张%%
%%事件识别：落点检测%%
> XJH

---
%%第十张：击球检测%%
> THN


---
%%第十一张：迷你球场%%
迷你球场相当于球场的可视化，是对球场上的反映，该图像在后续处理中将检测到的物体（如球场，网球，球员，落点）映射到小地图中，从而直观地展示物体相对于球场的位置分布。
首先，我们利用参考球场配置绘制一个标准迷你球场，在前面的球场关键点检测中，已经获得了非常关键的单应矩阵，它可以将实际检测到的球场投影到迷你球场上，这样我们就将迷你球场的坐标与实际球场的坐标对应起来，通过检测实际球场上的坐标（如网球坐标），便可获得迷你球场上的坐标。
迷你球场不仅可以反映场上的关键位置，而且使球速检测，击球检测更为准确，毕竟，由于摄像机视角的问题，在实际球场上检测连续帧下网球的距离是有偏差的，而在标准迷你球场下，由于视角是完全俯视的，距离检测，球速，击球的检测都会更加准确。

---
%%第十二张：球速可视化%%
> XJH

---
%%第十三张：落点可视化%%
> XJH

---
%%第十四张：应用和发展前景%%
> THN

---
%%第十五张：不足及未来的改进%%
1. 性能改进
	- 多进程 > WBZ
---
    逻辑优化

- 球和关键点结合检测：在球场关键点检测与网球检测中，我们用的都是同一个深度学习神经网络tracknet，因为两个任务是分开的，这样在每次检测中，都需要进行两次模型推导，比较麻烦。因此可以将两个检测的任务合并在一起，只需要通过一次模型推导，即可获得包含网球信息和球场关键点信息的特征图，进而获取坐标信息。具体实现可以修改神经网络的训练数据集，将网球的数据集与球场关键点的数据集分别标记并结合起来，使得一个神经网络就可以同时处理球和关键点的坐标问题。

-  图像增强：在球场检测时，部分帧下无法获取完整的球场信息或者有噪声影响，会导致检测到的关键点偏移过大，可以采取图像增强的技术对图像进行加工，去除噪声点的同时补全缺失的球场信息。

- 
---
	

	- 模型改进 > XJH

---
%%第十六张：致谢页%%


---
